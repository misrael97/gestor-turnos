<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="cargarTurnos($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-grid class="ion-padding">
    <!-- Turno Actual -->
    <ion-card *ngIf="turnoActual" color="success">
      <ion-card-header>
        <ion-card-title class="ion-text-center">
          <ion-icon name="megaphone" style="font-size: 48px;"></ion-icon>
          <ion-text style="font-size: 72px; margin: 10px 0;"><ion-label>{{ turnoActual.numero || turnoActual.id }}</ion-label></ion-text>
          <ion-text><ion-label>TURNO ACTUAL</ion-label></ion-text>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content class="ion-text-center">
        <ion-text><ion-label><strong>Cliente:</strong> {{ turnoActual.user?.name || 'N/A' }}</ion-label></ion-text>
        <ion-text><ion-label><strong>Hora llamado:</strong> {{ turnoActual.updated_at | date:'shortTime' }}</ion-label></ion-text>
      </ion-card-content>
    </ion-card>

    <!-- Estadísticas -->
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-card color="primary">
            <ion-card-content class="ion-text-center">
              <ion-text class="ion-no-margin"><ion-label>{{ turnosPendientes }}</ion-label></ion-text>
              <ion-text class="ion-no-margin"><ion-label>En Espera</ion-label></ion-text>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card color="tertiary">
            <ion-card-content class="ion-text-center">
              <ion-text class="ion-no-margin"><ion-label>{{ totalTurnos }}</ion-label></ion-text>
              <ion-text class="ion-no-margin"><ion-label>Total Hoy</ion-label></ion-text>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Botón Llamar Siguiente -->
    <ion-button expand="block" size="large" color="success" (click)="llamarSiguiente()" [disabled]="loading || turnosPendientes === 0">
      <ion-icon slot="start" name="megaphone"></ion-icon>
      LLAMAR SIGUIENTE TURNO
    </ion-button>

    <!-- Lista de Turnos en Espera -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Cola de Espera ({{ turnosPendientes }})</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>

        <ion-list *ngIf="!loading && turnos.length > 0">
          <ion-item *ngFor="let turno of turnos; let i = index">
            <ion-badge slot="start" color="primary">{{ i + 1 }}</ion-badge>
            <ion-label>
              <ion-text><ion-label><strong>Turno #{{ turno.numero || turno.id }}</strong></ion-label></ion-text>
              <ion-text><ion-label>{{ turno.user?.name || 'Cliente' }}</ion-label></ion-text>
              <ion-text class="ion-text-muted"><ion-label>{{ turno.created_at | date:'short' }}</ion-label></ion-text>
            </ion-label>
            <ion-badge slot="end" color="warning">{{ turno.estado }}</ion-badge>
          </ion-item>
        </ion-list>

        <ion-grid *ngIf="!loading && turnos.length === 0" class="ion-text-center ion-padding">
          <ion-icon name="checkmark-done-circle" style="font-size: 64px; color: #ccc;"></ion-icon>
          <ion-text><ion-label>No hay turnos en espera</ion-label></ion-text>
          <ion-text class="ion-text-muted"><ion-label>Los clientes pueden solicitar turnos desde la app</ion-label></ion-text>
        </ion-grid>
      </ion-card-content>
    </ion-card>
  </ion-grid>
</ion-content>
