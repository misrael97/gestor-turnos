<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="cargarTurnos($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="ion-padding">
    <!-- Turno Actual -->
    <ion-card *ngIf="turnoActual" color="success">
      <ion-card-header>
        <ion-card-title class="ion-text-center">
          <ion-icon name="megaphone" style="font-size: 48px;"></ion-icon>
          <h1 style="font-size: 72px; margin: 10px 0;">{{ turnoActual.numero || turnoActual.id }}</h1>
          <p>TURNO ACTUAL</p>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content class="ion-text-center">
        <p><strong>Cliente:</strong> {{ turnoActual.user?.name || 'N/A' }}</p>
        <p><strong>Hora llamado:</strong> {{ turnoActual.updated_at | date:'shortTime' }}</p>
      </ion-card-content>
    </ion-card>

    <!-- Estadísticas -->
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-card color="primary">
            <ion-card-content class="ion-text-center">
              <h1 class="ion-no-margin">{{ turnosPendientes }}</h1>
              <p class="ion-no-margin">En Espera</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card color="tertiary">
            <ion-card-content class="ion-text-center">
              <h1 class="ion-no-margin">{{ totalTurnos }}</h1>
              <p class="ion-no-margin">Total Hoy</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Botón Llamar Siguiente -->
    <ion-button expand="block" size="large" color="success" (click)="llamarSiguiente()" [disabled]="loading || turnosPendientes === 0">
      <ion-icon slot="start" name="megaphone"></ion-icon>
      LLAMAR SIGUIENTE TURNO
    </ion-button>

    <!-- Lista de Turnos en Espera -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Cola de Espera ({{ turnosPendientes }})</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>

        <ion-list *ngIf="!loading && turnos.length > 0">
          <ion-item *ngFor="let turno of turnos; let i = index">
            <ion-badge slot="start" color="primary">{{ i + 1 }}</ion-badge>
            <ion-label>
              <h2><strong>Turno #{{ turno.numero || turno.id }}</strong></h2>
              <p>{{ turno.user?.name || 'Cliente' }}</p>
              <p class="ion-text-muted">{{ turno.created_at | date:'short' }}</p>
            </ion-label>
            <ion-badge slot="end" color="warning">{{ turno.estado }}</ion-badge>
          </ion-item>
        </ion-list>

        <div *ngIf="!loading && turnos.length === 0" class="ion-text-center ion-padding">
          <ion-icon name="checkmark-done-circle" style="font-size: 64px; color: #ccc;"></ion-icon>
          <p>No hay turnos en espera</p>
          <p class="ion-text-muted">Los clientes pueden solicitar turnos desde la app</p>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
